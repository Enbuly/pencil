## 缓存与数据库数据一致性问题
    ### Cache-Aside
      读数据时:
        1、程序需要判断缓存中是否已经存在数据。
        2、当缓存中已经存在数据(也就是缓存命中)，则直接从缓存中返回数据
        3、当缓存中不存在数据(也就是缓存未命中)，则先从数据库里读取数据，并且存入缓存，然后返回数据
      写数据时，我们可以有以下两种策略:
        第一种策略:
          1、删除缓存中对应的数据
          2、更新数据库
        第二种策略:
          1、更新数据库
          2、删除缓存中对应的数据
        删除or更新:
          写多读少用删除，写少读多用更新。其实缓存大部分
          是读多写少的情况？
        线程安全问题:
          第一种策略:
            先删除缓存，再更新数据库，先删除缓存成功，还
            未更新数据库的时候，读线程进来了，发现缓存为空
            去数据库拉数据，然后更新了缓存，写线程这个时候
            把数据写进去了，缓存不一致了。
            如果数据库修改失败了，那么数据库中是旧数据，缓
            存中是空的，那么数据不会不一致。
          第二种策略:
            先更新数据库，再删除缓存中对应的数据，如果删除
            缓存失败，数据不一致。
            如果更新了数据库，还未删除缓存，读线程进来了，直接
            读到旧的缓存，数据不一致。
        问题:
          这样看起来貌似先删除缓存，再更新数据库，稍微好一点。
          那怎么解决那个不一致问题呢？
        延时双删:
          删除缓存->更新数据库->睡眠->删除缓存
          这种方案仍可能不一致。
          假设有三个线程ABC。A线程是写的，BC是读线程。
          A删除缓存后，B线程读发现缓存没有数据，然后
          去数据库拉数据，这个时候A去更新了数据库，然后
          B去写了数据库。这个时候是不一致的，然后C进来了
          读了数据脏数据，就是在A睡眠这段时间读取的数据都是
          脏数据，直至A执行第二次删除。
          睡眠也会带来一定性能问题。
        加锁:
          如果要实现一定一致，读写请求都加锁，单机可以用jvm的
          锁，分布式用分布式锁。然后采用先删除缓存中对应的数据，
          再更新数据库的方案。
          但是这样做违背了使用缓存的本质？值得吗？
    ### Read-Through/Write-Through
      说明:
        这种模式中，应用程序将缓存作为主要的数据源，更新数据库和从数据库的读取
        的任务都交给缓存来代理了，所以对于应用程序来说，简单很多。
      Read-Through
        由缓存配置一个读模块，它知道如何将数据库中的数据写入缓存。在数据被请求的时候，如果未命中，则将数据从数据库载入缓存。
      Write-Through
        缓存配置一个写模块，它知道如何将数据写入数据库。当应用要写入数据时，缓存会先存储数据，并调用写模块将数据写入数据库。
      应用场景:
        Read Through/Write Through适用于写入之后经常被读取的应用。
      优点:
        1、缓存不存在脏数据
        2、相比较Cache-Aside懒加载模式，读取速度更高，因为较少因为缓存未命中而从数据库中查找
        3、应用程序的逻辑相对简单
      缺点:
        1、有数据丢失的风险，如果缓存挂掉而数据没有及时写到数据库中，那么缓存中的有些数据将永久的丢失了
    ### Write-Back
      说明:
        又叫做Write-Behind。Write-Back将缓存作为可靠的数据源，每次都只写入缓存，而写入数据库
        则采用异步的方式，比如当数据要被移除出缓存的时候再存储到数据库或者一段时间之后批量更新数据库。
      应用场景:
        读写效率都非常好，写的时候因为异步存储到数据库，提升了写的效率，适用于读写密集的应用。
      优点:
        1、缓存不存在脏数据
        2、读写效率都非常好，写的时候因为异步存储到数据库，提升了写的效率，适用于读写密集的应用。
        3、写入和读取数据都非常的快，因为都是从缓存中直接读取和写入。
      缺点:
        1、有数据丢失的风险，如果缓存挂掉而数据没有及时写到数据库中，那么缓存中的有些数据将永久的丢失了


      

